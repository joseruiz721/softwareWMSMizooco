<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="/manifest.json">
    <title>Gestion WMS | Servibarras</title>
    
    <!-- Estilos externos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/dashboard-enhanced.css">
    <link rel="stylesheet" href="/css/horariosCalendario.css">
</head>
<body>
    <div class="app-container">
        
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="img/logo1.jpg" alt="Servibarras Logo" class="logo">
                <span class="sidebar-title">Gestion WMS</span>
            </div>
            
            <ul class="menu-list">
                <!-- Menú Dispositivos -->
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-desktop dispositivo-icon"></i>
                        <span>Dispositivos</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li class="submenu-item">
                            <a href="/dispositivos" class="submenu-link">
                                <i class="fas fa-plus-circle"></i>
                                <span>Registrar Nuevo</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" id="estadisticas-link">
                                <i class="fas fa-plus-circle"></i>
                                <span>Dispositivos Mizooco</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <!-- Menú Repuestos -->
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i href="#" class="fas fa-tools"></i>
                        <span>Repuestos</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li class="submenu-item">
                            <a href="/repuestos" class="submenu-link"> 
                               <i class="fas fa-plus-circle"></i>
                               <span>Registrar Nuevo</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" id="estadisticas-insumos-link">
                                <i class="fas fa-chart-line"></i>
                                <span>Inventario de Repuestos</span>
                            </a>
                        </li>
                        
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" id="inventarios-link">
                                <i class="fas fa-clipboard-list"></i>
                                <span>Exportar Inventario</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <!-- Menú Mantenimientos -->
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-clipboard-check"></i>
                        <span>Mantenimientos</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li class="submenu-item">
                            <a href="/mantenimientos" class="submenu-link">
                                <i class="fas fa-plus-circle"></i>
                                <span>Registrar Nuevo</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" id="control-mantenimientos-link">
                                <i class="fas fa-list-alt"></i>
                                <span>Control de Mantenimientos</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" id="reportes-mensuales-link">
                                <i class="fas fa-chart-bar"></i>
                                <span>Reportes Mensuales</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <!-- Menú Configuración -->
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-cog"></i>
                        <span>Configuración</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" onclick="ProfileManager.loadAndShowProfile()">
                                <i class="fas fa-user-cog"></i>
                                <span>Perfil</span>
                            </a>
                        </li>
        
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" id="admin-users-link">
                                <i class="fas fa-users-cog"></i>
                                <span>Gestionar Usuarios</span>
                            </a>
                        </li>   
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" id="horarios-trabajo-link">
                                <i class="fas fa-clock"></i>
                                <span>Horarios de Trabajo</span>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </aside>

        <!-- Contenido principal -->
        <div class="main-content">
            
            <!-- Header -->
            <header class="header">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Buscar dispositivos, repuestos..." autocomplete="off">
                    <div class="search-results-container" id="searchResults">
                        <!-- Los resultados de búsqueda se mostrarán aquí dinámicamente -->
                    </div>
                </div>
                
                <div class="header-actions">
                    <div class="notification-badge">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </div>

                    <div class="user-dropdown">
                        <div class="user-profile" id="userProfile">
                            <div class="user-avatar" id="userAvatar">GS</div>
                            <span class="user-name" id="userName">TECNICO</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="dropdown-menu" id="userDropdown">
                            <a href="#" class="dropdown-item">
                                <i class="fas fa-user"></i> Mi Perfil
                            </a>
                        
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Contenido del dashboard -->
            <div class="dashboard">
                
                <!-- Encabezado de página -->
                <div class="page-header">
                    <h1 class="page-title" style="color:#021e3a; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
                        Gestion WMS Mizooco
                    </h1>
                    <div id="welcome-message" style="margin-right: auto; margin-left: 20px; font-weight: 500; color: white;"></div>
                     <button class="btn btn-secondary" id="refreshPageBtn" title="Recargar página completa">
                          <i class="fas fa-redo-alt"></i> Refrescar Página
                    </button>
    
                    <button class="btn btn-primary" id="refreshDashboard">
                           <i class="fas fa-sync-alt"></i> Actualizar Datos
                    </button>
                </div>

                <!-- NUEVA SECCIÓN: Dashboard con Calendario -->
                <div class="dashboard-content" id="dashboard-section">
                    <div class="dashboard-grid">
                        <!-- Tarjetas de estadísticas principales MEJORADAS -->
                        <div class="stats-grid" id="main-stats">
                            <div class="stat-card">
                                <div class="stat-header">
                                    <h3 class="stat-title">Dispositivos Registrados</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-desktop"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="active-devices">0</div>
                                <div class="stat-trend" id="devices-trend">
                                    <i class="fas fa-arrow-up trend-up"></i>
                                    <span class="trend-text">Cargando...</span>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-header">
                                    <h3 class="stat-title">Repuestos</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-box"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="total-supplies">0</div>
                                <div class="stat-trend" id="supplies-trend">
                                    <i class="fas fa-arrow-up trend-up"></i>
                                    <span class="trend-text">Cargando...</span>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-header">
                                    <h3 class="stat-title">Alertas Hoy</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="today-alerts">0</div>
                                <div class="stat-trend" id="alerts-trend">
                                    <span class="trend-text">Cargando...</span>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-header">
                                    <h3 class="stat-title">Usuarios Activos</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="active-techs">0</div>
                                <div class="stat-trend" id="techs-trend">
                                    <i class="fas fa-arrow-up trend-up"></i>
                                    <span class="trend-text">Cargando...</span>
                                </div>
                            </div>
                        </div>

                        <!-- NUEVO: Calendario de Mantenimientos -->
                        <div class="dashboard-row">
                            <div class="calendar-section">
                                <div class="section-header">
                                    <h3>Calendario de Mantenimientos</h3>
                                    <button class="btn btn-secondary" id="today-btn">Hoy</button>
                                </div>
                                <div id="calendar"></div>
                            </div>
                            
                            <div class="quick-actions">
                                <div class="section-header">
                                    <h3>Acciones Rápidas</h3>
                                </div>
                                <div class="action-buttons">
                                    <button class="action-btn" onclick="window.location.href='/mantenimientos'">
                                        <i class="fas fa-tools"></i>
                                        <span>Nuevo Mantenimiento</span>
                                    </button>
                                    <button class="action-btn" onclick="window.location.href='/dispositivos'">
                                        <i class="fas fa-desktop"></i>
                                        <span>Registrar Dispositivo</span>
                                    </button>
                                    <button class="action-btn" onclick="window.location.href='/repuestos'">
                                        <i class="fas fa-box"></i>
                                        <span>Agregar Repuesto</span>
                                    </button>
                                    <button class="action-btn" id="export-inventory-btn">
                                        <i class="fas fa-file-export"></i>
                                        <span>Exportar Inventario</span>
                                    </button>
                                </div>
                                
                                <!-- Alertas Recientes -->
                                <div class="recent-alerts">
                                    <div class="section-header">
                                        <h3>Alertas Recientes</h3>
                                    </div>
                                    <div class="alerts-list" id="recent-alerts">
                                        <!-- Las alertas se cargarán dinámicamente -->
                                        <div class="alert-item">
                                            <i class="fas fa-info-circle alert-info"></i>
                                            <span>Cargando alertas...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección: Control de Mantenimientos -->
                <div class="stats-section" id="control-mantenimientos-section" style="display: none;">
                    <div class="section-header">
                        <h2 style="color: #03213f; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);">
                            Control de Mantenimientos
                        </h2>
                        <button class="btn btn-secondary btn-back-dashboard">
                            <i class="fas fa-arrow-left"></i> Volver al Dashboard
                        </button>
                        <button class="btn btn-primary" id="refresh-maintenance">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                    
                    <div class="stats-container">
                        <div class="maintenance-table-container">
                            <table class="maintenance-table">
                                <thead>
                                    <tr>
                                        <th>Técnico</th>
                                        <th>Tipo</th>
                                        <th>Ubicación</th>
                                        <th>Fecha</th>
                                        <th>Estado</th>
                                        <th>Descripción</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="maintenance-table-body">
                                    <!-- Los datos se cargarán aquí dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sección: Reportes Mensuales -->
                <div class="stats-section" id="reportes-mensuales-section" style="display: none;">
                    <div class="section-header">
                        <h2 style="color: #03213f; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);">
                            Reportes Mensuales de Mantenimientos
                        </h2>
                        <button class="btn btn-secondary btn-back-dashboard">
                            <i class="fas fa-arrow-left"></i> Volver al Dashboard
                        </button>
                        <button class="btn btn-primary" id="generar-reporte-btn">
                            <i class="fas fa-file-pdf"></i> Generar Reporte PDF
                        </button>
                    </div>
                    
                    <div class="reportes-container">
                        <!-- Filtros -->
                        <div class="filtros-reporte">
                            <div class="filtro-group">
                                <label for="mes-reporte">Mes:</label>
                                <select id="mes-reporte" class="filtro-select">
                                    <option value="1">Enero</option>
                                    <option value="2">Febrero</option>
                                    <option value="3">Marzo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Mayo</option>
                                    <option value="6">Junio</option>
                                    <option value="7">Julio</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Septiembre</option>
                                    <option value="10">Octubre</option>
                                    <option value="11">Noviembre</option>
                                    <option value="12">Diciembre</option>
                                </select>
                            </div>
                            
                            <div class="filtro-group">
                                <label for="anio-reporte">Año:</label>
                                <select id="anio-reporte" class="filtro-select">
                                    <!-- Se llenará dinámicamente -->
                                </select>
                            </div>
                            
                            <div class="filtro-group">
                                <label for="tipo-reporte">Tipo de Reporte:</label>
                                <select id="tipo-reporte" class="filtro-select">
                                    <option value="completo">Reporte Completo</option>
                                    <option value="preventivo">Solo Preventivos</option>
                                    <option value="correctivo">Solo Correctivos</option>
                                    <option value="predictivo">Solo Predictivos</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-success" id="aplicar-filtros">
                                <i class="fas fa-filter"></i> Aplicar Filtros
                            </button>
                        </div>

                        <!-- Estadísticas Resumen -->
                        <div class="estadisticas-resumen">
                            <div class="stat-card mini">
                                <div class="stat-header">
                                    <h3 class="stat-title">Total Mantenimientos</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-clipboard-list"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="total-mantenimientos">0</div>
                            </div>
                            
                            <div class="stat-card mini">
                                <div class="stat-header">
                                    <h3 class="stat-title">Preventivos</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-shield-alt"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="total-preventivos">0</div>
                            </div>
                            
                            <div class="stat-card mini">
                                <div class="stat-header">
                                    <h3 class="stat-title">Correctivos</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-tools"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="total-correctivos">0</div>
                            </div>
                            
                            <div class="stat-card mini">
                                <div class="stat-header">
                                    <h3 class="stat-title">Eficiencia</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="eficiencia">0%</div>
                            </div>
                        </div>

                        <!-- Gráficas -->
                        <div class="reporte-charts">
                            <div class="chart-card large">
                                <h3>Distribución por Tipo</h3>
                                <div class="chart-container">
                                    <canvas id="tipo-mantenimiento-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="chart-card large">
                                <h3>Mantenimientos por Técnico</h3>
                                <div class="chart-container">
                                    <canvas id="tecnico-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="chart-card large">
                                <h3>Evolución Semanal</h3>
                                <div class="chart-container">
                                    <canvas id="evolucion-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="chart-card large">
                                <h3>Dispositivos más Atendidos</h3>
                                <div class="chart-container">
                                    <canvas id="dispositivos-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Tabla Detallada -->
                        <div class="tabla-reporte">
                            <div class="table-header">
                                <h3>Detalle de Mantenimientos</h3>
                                <button class="btn btn-secondary" id="exportar-excel">
                                    <i class="fas fa-file-excel"></i> Exportar a Excel
                                </button>
                            </div>
                            <div class="table-container">
                                <table class="reporte-table">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Técnico</th>
                                            <th>Tipo</th>
                                            <th>Ubicación</th>
                                            <th>Estado</th>
                                            <th>Repuestos Usados</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabla-reporte-body">
                                        <!-- Datos se cargarán aquí -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección: Horarios de Trabajo -->
                <div class="stats-section" id="horarios-calendario-section" style="display: none;">
                    <div class="section-header">
                        <h2 style="color: #03213f; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);">
                            Gestión de Horarios de Trabajo
                        </h2>
                        <button class="btn btn-secondary btn-back-dashboard">
                            <i class="fas fa-arrow-left"></i> Volver al Dashboard
                        </button>
                    </div>
                    
                    <div class="horarios-calendario-container">
                        <!-- Controles del calendario -->
                        <div class="controles-calendario">
                            <div class="control-group">
                                <label for="mes-calendario">Mes:</label>
                                <select id="mes-calendario" class="control-select">
                                    <!-- Se llena dinámicamente -->
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label for="anio-calendario">Año:</label>
                                <select id="anio-calendario" class="control-select">
                                    <!-- Se llena dinámicamente -->
                                </select>
                            </div>
                            
                            <div class="acciones-calendario">
                                <button class="btn btn-info" id="nuevo-tecnico-btn">
                                    <i class="fas fa-user-plus"></i> Nuevo Técnico
                                </button>
                                <button class="btn btn-success" id="guardar-horarios">
                                    <i class="fas fa-save"></i> Guardar Horarios
                                </button>
                                <button id="exportar-pdf-btn" class="btn-exportar-pdf">
                                    <i class="fas fa-file-pdf"></i> Exportar PDF
                                </button>
                            </div>
                        </div>

                        <!-- Calendario -->
                        <div class="calendario-container">
                            <div id="calendario-horarios">
                                <!-- El calendario se renderiza aquí dinámicamente -->
                                <div class="loading-calendario">
                                    <i class="fas fa-spinner fa-spin"></i> Cargando calendario...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección: Gestionar Usuarios -->
                <div class="stats-section" id="admin-users-section" style="display: none;">
                    <div class="section-header">
                        <h2 style="color: #03213f; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);">
                            Gestión de Usuarios
                        </h2>
                        <button class="btn btn-secondary btn-back-dashboard">
                            <i class="fas fa-arrow-left"></i> Volver al Dashboard
                        </button>
                        <button class="btn btn-primary" id="refresh-users">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                    
                    <div class="stats-container">
                        <!-- Contenido de gestión de usuarios se cargará dinámicamente -->
                        <div id="admin-users-content">
                            <!-- Los datos de usuarios se cargarán aquí -->
                        </div>
                    </div>
                </div>

                <!-- Sección: Estadísticas de Dispositivos -->
                <div class="stats-section" id="estadisticas-section" style="display: none;">
                    <div class="section-header">
                        <h2 style="color: #2c3e50; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);">
                            Dispositivos Mizooco
                        </h2>
                         <button class="btn btn-secondary btn-back-dashboard">
                            <i class="fas fa-arrow-left"></i> Volver al Dashboard
                        </button>
                        <button class="btn btn-primary" id="refresh-stats">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                    
                    <div class="stats-container">
                        <div class="device-type-controls">
                            <button id="btn-ordenadores" class="device-type-btn active">Ordenadores</button>
                            <button id="btn-access_point" class="device-type-btn">Access Point</button>
                            <button id="btn-readers" class="device-type-btn">Readers</button>
                            <button id="btn-etiquetadoras" class="device-type-btn">Etiquetadoras</button>
                            <button id="btn-tablets" class="device-type-btn">Tablets</button>
                            <button id="btn-lectores_qr" class="device-type-btn">Lectores QR</button>
                        </div>
                        
                        <div class="devices-table-container">
                            <table class="devices-table">
                                <thead>
                                    <tr>
                                        <th>Serial</th>
                                        <th>IP</th>
                                        <th>Ubicación</th>
                                        <th>Activo Fijo</th>
                                        <th>Estado</th>
                                        <th>Observaciones</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="devices-table-body">
                                    <!-- Los datos se cargarán aquí dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="stats-charts">
                            <div class="chart-card">
                                <h3>Distribución por Tipo</h3>
                                <div class="chart-container">
                                    <canvas id="type-chart"></canvas>
                                </div>
                            </div>
                            <div class="chart-card">
                                <h3>Distribución por Estado</h3>
                                <div class="chart-container">
                                    <canvas id="status-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección: Estadísticas de Repuestos -->
                <div class="stats-section" id="estadisticas-insumos-section" style="display: none;">
                    <div class="section-header">
                        <h2 style="color: rgb(4, 14, 58); text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);">
                            Inventario de Repuestos
                        </h2>
                        <button class="btn btn-secondary btn-back-dashboard">
                            <i class="fas fa-arrow-left"></i> Volver al Dashboard
                        </button>
                        <button class="btn btn-primary" id="refresh-insumos-stats">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                    
                    <div class="stats-container">
                        <div class="supply-category-controls">
                            <button id="btn-todos" class="supply-category-btn active">Todos</button>
                            <button id="btn-bajo_stock" class="supply-category-btn">Bajo Stock</button>
                            <button id="btn-agotados" class="supply-category-btn">Agotados</button>
                        </div>
                        
                        <div class="supplies-table-container">
                            <table class="supplies-table">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Código</th>
                                        <th>Stock</th>
                                        <th>Stock Mínimo</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="supplies-table-body">
                                    <!-- Los datos se cargarán aquí dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="stats-charts">
                            <div class="chart-card">
                                <h3>Distribución por Proceso</h3>
                                <div class="chart-container">
                                    <canvas id="category-chart"></canvas>
                                </div>
                            </div>
                            <div class="chart-card">
                                <h3>Niveles de Stock</h3>
                                <div class="chart-container">
                                    <canvas id="stock-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modales de la aplicación -->
                <!-- Modal: Edición de Mantenimientos -->
                <div id="maintenanceModal" class="maintenance-modal">
                    <div class="maintenance-modal-content">
                        <span class="close-modal" onclick="MaintenanceManager.closeModal()">&times;</span>
                        <h2 id="maintenance-modal-title">Registrar Mantenimiento</h2>
                        <form id="maintenanceForm">
                            <div class="maintenance-form-group">
                                <label for="maintenance-technician">Técnico *</label>
                                <select id="maintenance-technician" name="id_usuarios" required>
                                    <option value="">Seleccionar técnico</option>
                                </select>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-type">Tipo de Mantenimiento *</label>
                                <select id="maintenance-type" name="tipo" required>
                                    <option value="">Seleccionar tipo</option>
                                    <option value="Preventivo">Preventivo</option>
                                    <option value="Correctivo">Correctivo</option>
                                    <option value="Predictivo">Predictivo</option>
                                </select>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-device">Dispositivo *</label>
                                <select id="maintenance-device" name="id_dispositivo" required>
                                    <option value="">Seleccionar dispositivo</option>
                                 </select>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-date">Fecha *</label>
                                <input type="date" id="maintenance-date" name="fecha" required>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-status">Estado *</label>
                                <select id="maintenance-status" name="estado" required>
                                    <option value="Pendiente">Pendiente</option>
                                    <option value="En Progreso">En Progreso</option>
                                    <option value="Completado">Completado</option>
                                    <option value="Cancelado">Cancelado</option>
                                </select>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-supply">Repuesto (Opcional)</label>
                                <select id="maintenance-supply" name="id_repuesto">
                                    <option value="">Sin repuesto</option>
                                </select>
                                <small class="form-help">Deje en "Sin repuesto" si no aplica</small>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-description">Descripción *</label>
                                <textarea id="maintenance-description" name="descripcion" 
                                         placeholder="Describa el mantenimiento a realizar..." 
                                         required></textarea>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-observations">Observaciones (Opcional)</label>
                                <textarea id="maintenance-observations" name="observaciones" 
                                         placeholder="Observaciones adicionales..."></textarea>
                            </div>
                            
                            <div class="maintenance-form-actions">
                                <button type="button" class="btn btn-back" onclick="MaintenanceManager.closeModal()">Cancelar</button>
                                <button type="submit" class="btn btn-primary" id="maintenance-submit-btn">
                                    <span id="maintenance-submit-text">Guardar</span>
                                    <div id="maintenance-loading-spinner" class="loading-spinner" style="display: none;"></div>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Modal: Edición de Dispositivos -->
                <div id="editModal" class="edit-modal">
                    <div class="edit-modal-content">
                        <span class="close-modal" onclick="InventoryApp.closeEditModal()">&times;</span>
                        <h2>Editar Dispositivo</h2>
                        <form id="editForm">
                            <div id="editFormFields"></div>
                            <div class="edit-form-actions">
                                <button type="button" class="btn btn-back" onclick="InventoryApp.closeEditModal()">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Modal: Exportación de Inventarios -->
                <div id="exportModal" class="export-modal">
                    <div class="export-modal-content">
                        <span class="close-modal" onclick="InventoryApp.closeModal('exportModal')">&times;</span>
                        <h2 style="color: #000080;">Exportar Inventario</h2>
                        <p>Seleccione el formato para exportar el inventario actual:</p>
                        
                        <div class="export-options">
                            <button class="export-btn export-excel" onclick="InventoryApp.exportInventory('excel')">
                                <i class="fas fa-file-excel"></i> Exportar a Excel
                            </button>
                            <button class="export-btn export-cancel" onclick="InventoryApp.closeModal('exportModal')">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                        
                        <div id="exportStatus" class="export-status" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p class="status-message"></p>
                        </div>
                    </div>
                </div>
                
                <!-- Modal: Perfil de Usuario -->
                <div id="profileModal" class="modal" style="display: none;">
                    <div class="modal-content profile-modal-content">
                        <span class="close-modal" onclick="ProfileManager.closeProfileModal()">&times;</span>
                        
                        <div class="modal-header">
                            <h2><i class="fas fa-user-circle profile-icon"></i> Perfil del Usuario</h2>
                            <p class="modal-subtitle">Gestiona tu información personal y seguridad</p>
                        </div>
                        
                        <div class="profile-info">
                            <!-- Información Personal -->
                            <div class="info-section">
                                <h3><i class="fas fa-id-card"></i> Información Personal</h3>
                                
                                <div class="info-card editable">
                                    <div class="info-row">
                                        <div class="info-icon"><i class="fas fa-user"></i></div>
                                        <div class="info-content">
                                            <div class="info-label">Nombre completo</div>
                                            <div id="profile-name" class="info-value">Cargando...</div>
                                            <input type="text" id="edit-profile-name" class="info-input" style="display: none;" placeholder="Ingrese su nombre">
                                        </div>
                                        <button class="btn-edit" onclick="ProfileManager.toggleEdit('name')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="info-card editable">
                                    <div class="info-row">
                                        <div class="info-icon"><i class="fas fa-id-card"></i></div>
                                        <div class="info-content">
                                            <div class="info-label">Cédula</div>
                                            <div id="profile-cedula" class="info-value">Cargando...</div>
                                            <input type="text" id="edit-profile-cedula" class="info-input" style="display: none;" placeholder="Ingrese su cédula">
                                        </div>
                                        <button class="btn-edit" onclick="ProfileManager.toggleEdit('cedula')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="info-card editable">
                                    <div class="info-row">
                                        <div class="info-icon"><i class="fas fa-envelope"></i></div>
                                        <div class="info-content">
                                            <div class="info-label">Correo electrónico</div>
                                            <div id="profile-email" class="info-value">Cargando...</div>
                                            <input type="email" id="edit-profile-email" class="info-input" style="display: none;" placeholder="Ingrese su correo">
                                        </div>
                                        <button class="btn-edit" onclick="ProfileManager.toggleEdit('email')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="info-card">
                                    <div class="info-row">
                                        <div class="info-icon"><i class="fas fa-calendar-plus"></i></div>
                                        <div class="info-content">
                                            <div class="info-label">Miembro desde</div>
                                            <div id="profile-date" class="info-value">Cargando...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Botón para cambiar contraseña -->
                            <button class="btn btn-primary" id="toggle-password-change" onclick="ProfileManager.togglePasswordChange()">
                                <i class="fas fa-key"></i> Cambiar Contraseña
                            </button>
                            
                            <!-- Sección de cambio de contraseña MEJORADA -->
                            <div class="info-card" id="password-change-section" style="display: none;">
                                <div class="info-row">
                                    <div class="info-icon"><i class="fas fa-key"></i></div>
                                    <div class="info-content">
                                        <div class="info-label">Nueva contraseña</div>
                                        <div class="password-input-container">
                                            <input type="password" id="new-password" class="info-input password-input" 
                                                   placeholder="Mínimo 6 caracteres" 
                                                   oninput="ProfileManager.updatePasswordStrength()">
                                            <button type="button" class="toggle-password-btn" 
                                                    onclick="ProfileManager.togglePasswordVisibility('new-password', this)"
                                                    title="Mostrar contraseña">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        
                                        <!-- Indicador de fortaleza -->
                                        <div class="password-strength-meter" id="password-strength-meter">
                                            <div class="strength-bar"></div>
                                        </div>
                                        <div class="password-strength-text" id="password-strength-text" style="font-size: 11px; color: #7f8c8d;">
                                            Ingresa una contraseña
                                        </div>
                                        
                                        <!-- Validaciones -->
                                        <div class="password-validations" id="password-validations" style="margin-top: 8px;">
                                            <div class="validation-item invalid">
                                                <i class="fas fa-times validation-icon"></i>
                                                <span>Mínimo 6 caracteres</span>
                                            </div>
                                            <div class="validation-item invalid">
                                                <i class="fas fa-times validation-icon"></i>
                                                <span>Al menos una mayúscula</span>
                                            </div>
                                            <div class="validation-item invalid">
                                                <i class="fas fa-times validation-icon"></i>
                                                <span>Al menos una minúscula</span>
                                            </div>
                                            <div class="validation-item invalid">
                                                <i class="fas fa-times validation-icon"></i>
                                                <span>Al menos un número</span>
                                            </div>
                                        </div>
                                        
                                        <div class="info-label" style="margin-top: 15px;">Confirmar contraseña</div>
                                        <div class="password-input-container">
                                            <input type="password" id="confirm-password" class="info-input password-input" 
                                                   placeholder="Repita la contraseña">
                                            <button type="button" class="toggle-password-btn" 
                                                    onclick="ProfileManager.togglePasswordVisibility('confirm-password', this)"
                                                    title="Mostrar contraseña">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        
                                        <!-- Indicador de coincidencia -->
                                        <div id="password-match" style="font-size: 11px; margin-top: 5px;"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Botón guardar -->
                            <button class="btn btn-success" id="save-profile-btn" style="display: none;" onclick="ProfileManager.saveProfile()">
                                <i class="fas fa-save"></i> Guardar Cambios
                            </button>
                            
                            <div class="action-group">
                                <button class="btn btn-warning" onclick="ProfileManager.loadAndShowProfile()">
                                    <i class="fas fa-sync"></i> Actualizar
                                </button>
                                <button class="btn btn-danger" onclick="ProfileManager.confirmDeleteAccount()">
                                    <i class="fas fa-trash"></i> Eliminar Cuenta
                                </button>
                                <button class="btn btn-secondary" onclick="ProfileManager.closeProfileModal()">
                                    <i class="fas fa-times"></i> Cerrar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal: Confirmación de eliminación de cuenta -->
                <div id="deleteAccountModal" class="modal" style="display: none;">
                    <div class="modal-content danger-modal">
                        <span class="close-modal" onclick="ProfileManager.closeModal('deleteAccountModal')">&times;</span>
                        
                        <div class="modal-header danger-header">
                            <h2><i class="fas fa-exclamation-triangle"></i> Confirmar Eliminación</h2>
                            <p class="modal-subtitle">Esta acción no se puede deshacer</p>
                        </div>
                        
                        <div class="delete-warning">
                            <div class="warning-icon">
                                <i class="fas fa-skull-crossbones"></i>
                            </div>
                            <div class="warning-content">
                                <h3>¿Está completamente seguro?</h3>
                                <p>Al eliminar su cuenta:</p>
                                <ul>
                                    <li>Se perderán todos sus datos permanentemente</li>
                                    <li>No podrá recuperar su cuenta</li>
                                    <li>Se cerrará su sesión inmediatamente</li>
                                </ul>
                                <p>Para confirmar, escriba <strong>ELIMINAR</strong> en el campo siguiente:</p>
                                
                                <input type="text" id="confirm-delete-text" class="confirm-input" 
                                       placeholder="Escriba ELIMINAR para confirmar">
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button class="btn btn-danger" id="confirm-delete-btn" onclick="ProfileManager.deleteAccount()" disabled>
                                <i class="fas fa-trash"></i> Eliminar Cuenta Permanentemente
                            </button>
                            <button class="btn btn-secondary" onclick="ProfileManager.closeModal('deleteAccountModal')">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Modal: Subir Horario de Trabajo -->
                <div id="horarioModal" class="modal">
                    <div class="modal-content">
                        <span class="close-modal" onclick="HorariosManager.closeModal()">&times;</span>
                        <h2><i class="fas fa-upload"></i> Subir Horario de Trabajo</h2>
                        
                        <form id="horarioForm" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="horario-mes">Mes *</label>
                                <select id="horario-mes" name="mes" required>
                                    <option value="">Seleccionar mes</option>
                                    <option value="1">Enero</option>
                                    <option value="2">Febrero</option>
                                    <option value="3">Marzo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Mayo</option>
                                    <option value="6">Junio</option>
                                    <option value="7">Julio</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Septiembre</option>
                                    <option value="10">Octubre</option>
                                    <option value="11">Noviembre</option>
                                    <option value="12">Diciembre</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="horario-anio">Año *</label>
                                <select id="horario-anio" name="anio" required>
                                    <!-- Se llenará dinámicamente -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="horario-archivo">Archivo PDF *</label>
                                <div class="file-upload-container">
                                    <input type="file" id="horario-archivo" name="archivo" 
                                           accept=".pdf" required class="file-input">
                                    <label for="horario-archivo" class="file-upload-label">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <span>Seleccionar archivo PDF</span>
                                    </label>
                                    <div id="nombre-archivo" class="file-name"></div>
                                </div>
                                <small class="form-help">Solo se permiten archivos PDF. Tamaño máximo: 10MB</small>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="HorariosManager.closeModal()">
                                    Cancelar
                                </button>
                                <button type="submit" class="btn btn-primary" id="subir-horario-submit">
                                    <i class="fas fa-upload"></i> Subir Horario
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Modal: Visualizar PDF -->
                <div id="pdfViewerModal" class="modal pdf-viewer-modal">
                    <div class="modal-content pdf-viewer-content">
                        <span class="close-modal" onclick="HorariosManager.closePdfViewer()">&times;</span>
                        <div class="pdf-viewer-header">
                            <h3 id="pdf-viewer-title">Visualizando Horario</h3>
                            <button class="btn btn-secondary" onclick="HorariosManager.downloadPdf()">
                                <i class="fas fa-download"></i> Descargar
                            </button>
                        </div>
                        <div class="pdf-viewer-container">
                            <iframe id="pdf-viewer" src="" width="100%" height="600px" 
                                    frameborder="0" allowfullscreen></iframe>
                        </div>
                    </div>
                </div>
                
                <!-- Modal: Nuevo Técnico -->
                <div id="modal-tecnico" class="modal">
                    <div class="modal-content">
                        <span class="close-modal" onclick="HorariosCalendario.ocultarModalTecnico()">&times;</span>
                        
                        <div class="modal-header">
                            <h3><i class="fas fa-user-plus"></i> Agregar Nuevo Técnico</h3>
                        </div>
                        
                        <div class="modal-body">
                            <form id="form-tecnico">
                                <div class="form-group">
                                    <label for="nombre-tecnico">Nombre del Técnico *</label>
                                    <input type="text" id="nombre-tecnico" class="form-control" 
                                           placeholder="Ingrese el nombre completo" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="color-tecnico">Color de identificación</label>
                                    <input type="color" id="color-tecnico" class="color-picker" value="#007bff">
                                </div>
                            </form>
                        </div>
                        
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="HorariosCalendario.ocultarModalTecnico()">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button class="btn btn-primary" id="guardar-tecnico">
                                <i class="fas fa-save"></i> Guardar Técnico
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <footer class="footer">
                    <div class="footer-content">
                        <span class="version">Versión 2.1</span>
                        <span class="separator">|</span>
                        <span class="copyright">&copy; 2025 Gestion WMS Mizooco. Todos los derechos reservados.</span>
                    </div>
                </footer>
            </div>
        </div>
    </div>

    <!-- Scripts externos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <!-- Librerías para exportación -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Scripts de la aplicación -->
    <script src="/js/api.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/charts.js"></script>
    <script src="/js/profileManager.js"></script>
    <script src="/js/maintenanceManager.js"></script>
    <script src="/js/suppliesTableManager.js"></script>
    <script src="/js/inventoryApp.js"></script>
    <script src="/js/reportesManager.js"></script>
    <script src="/js/dashboard-enhanced.js"></script>
    <script src="/js/admin-users.js"></script>
    <script src="/js/horariosCalendario.js"></script>
    
    <!-- Asistencias: widget y modales -->
    <div id="asistencia-widget" style="position:fixed; right:18px; bottom:18px; z-index:9999;">
        <div style="display:flex; gap:8px;">
            <button id="btn-checkin" class="btn btn-success" title="Marcar Entrada">
                <i class="fas fa-sign-in-alt"></i>
            </button>
            <button id="btn-checkout" class="btn btn-danger" title="Marcar Salida">
                <i class="fas fa-sign-out-alt"></i>
            </button>
            <button id="btn-asistencia-report" class="btn btn-primary" title="Reporte Asistencias">
                <i class="fas fa-file-alt"></i>
            </button>
        </div>
    </div>

    <!-- Modal para captura de foto -->
    <div id="modal-asistencia" class="modal" style="display:none;">
        <div class="modal-content" style="max-width:700px;">
            <span class="close-modal" id="close-asistencia">&times;</span>
            <div class="modal-header"><h3>Registrar Asistencia</h3></div>
            <div class="modal-body">
                <!-- Selector de usuario para administradores -->
                <div id="usuario-selector-container" style="margin-bottom: 15px; display: none;">
                    <label for="usuario-asistencia">Registrar para:</label>
                    <select id="usuario-asistencia" class="form-control">
                        <option value="">Cargando usuarios...</option>
                    </select>
                    <small class="text-muted">Solo administradores pueden registrar para otros usuarios</small>
                </div>
                
                <div style="display:flex; gap:12px; flex-wrap:wrap;">
                    <div style="flex:1; min-width:280px;">
                        <video id="video-asistencia" autoplay playsinline style="width:100%; border-radius:6px; background:#000"></video>
                    </div>
                    <div style="flex:1; min-width:220px; display:flex; flex-direction:column; gap:8px; align-items:center;">
                        <canvas id="canvas-asistencia" width="320" height="240" style="display:none; border-radius:6px; background:#eee;"></canvas>
                        <div id="asistencia-buttons" style="display:flex; gap:8px;">
                            <button id="tomar-foto-btn" class="btn btn-primary">Tomar Foto</button>
                            <button id="enviar-checkin-btn" class="btn btn-success">Enviar Entrada</button>
                            <button id="enviar-checkout-btn" class="btn btn-danger">Enviar Salida</button>
                        </div>
                        <small id="asistencia-msg" style="display:block; color:#333"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal reporte -->
    <div id="modal-asistencia-report" class="modal" style="display:none;">
        <div class="modal-content" style="max-width:900px;">
            <span class="close-modal" id="close-asistencia-report">&times;</span>
            <div class="modal-header"><h3>Reporte de Asistencias</h3></div>
            <div class="modal-body">
                <div style="display:flex; gap:8px; align-items:center; margin-bottom:12px;">
                    <input type="date" id="report-start" class="form-control" />
                    <input type="date" id="report-end" class="form-control" />
                    <select id="report-user" class="form-control" style="min-width:200px;">
                        <option value="">Todos los usuarios</option>
                    </select>
                    <button id="buscar-report" class="btn btn-primary">Buscar</button>
                    <button id="export-report" class="btn btn-secondary">Exportar CSV</button>
                </div>
                <div style="max-height:400px; overflow:auto;">
                    <table class="table table-striped" id="tabla-asistencias">
                        <thead><tr><th>Fecha</th><th>Usuario</th><th>Tipo</th><th>Foto</th><th>IP</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/asistencias.js"></script>
    
    <!-- Script para gestionar la navegación entre secciones -->
    <script>
        // Variables para controlar las secciones
        let currentSection = 'dashboard-section';
        
        // Función para mostrar una sección específica
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.stats-section, .dashboard-content').forEach(section => {
                section.style.display = 'none';
            });
            
            // Mostrar la sección solicitada
            const section = document.getElementById(sectionId);
            if (section) {
                section.style.display = 'block';
                currentSection = sectionId;
                
                // Actualizar botones "Volver" si es necesario
                updateBackButtons();
                
                // Forzar actualización de contenido si es necesario
                if (sectionId === 'control-mantenimientos-section') {
                    if (typeof MaintenanceManager !== 'undefined') {
                        MaintenanceManager.loadMaintenanceData();
                    }
                } else if (sectionId === 'estadisticas-section') {
                    if (typeof InventoryApp !== 'undefined') {
                        InventoryApp.loadDeviceStats();
                    }
                } else if (sectionId === 'estadisticas-insumos-section') {
                    if (typeof InventoryApp !== 'undefined') {
                        InventoryApp.loadSuppliesStats();
                    }
                } else if (sectionId === 'reportes-mensuales-section') {
                    if (typeof ReportesManager !== 'undefined') {
                        ReportesManager.cargarAnios();
                        ReportesManager.cargarReportes();
                    }
                } else if (sectionId === 'horarios-calendario-section') {
                    if (typeof HorariosCalendario !== 'undefined') {
                        HorariosCalendario.inicializar();
                    }
                } else if (sectionId === 'admin-users-section') {
                    if (typeof AdminUsersManager !== 'undefined') {
                        AdminUsersManager.loadUsers();
                    }
                }
            }
        }
        
        // Función para actualizar los botones "Volver"
        function updateBackButtons() {
            document.querySelectorAll('.btn-back-dashboard').forEach(btn => {
                btn.innerHTML = '<i class="fas fa-arrow-left"></i> Volver al Dashboard';
                btn.onclick = () => showSection('dashboard-section');
            });
        }
        
        // Event Listeners para los enlaces del menú
        document.addEventListener('DOMContentLoaded', function() {
            // Control de Mantenimientos
            const controlMantenimientosLink = document.getElementById('control-mantenimientos-link');
            if (controlMantenimientosLink) {
                controlMantenimientosLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showSection('control-mantenimientos-section');
                });
            }
            
            // Reportes Mensuales
            const reportesMensualesLink = document.getElementById('reportes-mensuales-link');
            if (reportesMensualesLink) {
                reportesMensualesLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showSection('reportes-mensuales-section');
                });
            }
            
            // Dispositivos Mizooco
            const estadisticasLink = document.getElementById('estadisticas-link');
            if (estadisticasLink) {
                estadisticasLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showSection('estadisticas-section');
                });
            }
            
            // Inventario de Repuestos
            const estadisticasInsumosLink = document.getElementById('estadisticas-insumos-link');
            if (estadisticasInsumosLink) {
                estadisticasInsumosLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showSection('estadisticas-insumos-section');
                });
            }
            
            // Horarios de Trabajo
            const horariosTrabajoLink = document.getElementById('horarios-trabajo-link');
            if (horariosTrabajoLink) {
                horariosTrabajoLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showSection('horarios-calendario-section');
                });
            }
            
            // Gestionar Usuarios
            const adminUsersLink = document.getElementById('admin-users-link');
            if (adminUsersLink) {
                adminUsersLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showSection('admin-users-section');
                });
            }
            
            // Actualizar botones "Volver"
            updateBackButtons();
            
            // Botón de actualizar del dashboard
            const refreshDashboardBtn = document.getElementById('refreshDashboard');
            if (refreshDashboardBtn) {
                refreshDashboardBtn.addEventListener('click', function() {
                    if (currentSection === 'dashboard-section') {
                        if (typeof DashboardEnhanced !== 'undefined') {
                            DashboardEnhanced.loadDashboardData();
                        }
                    } else if (currentSection === 'control-mantenimientos-section') {
                        if (typeof MaintenanceManager !== 'undefined') {
                            MaintenanceManager.loadMaintenanceData();
                        }
                    } else if (currentSection === 'estadisticas-section') {
                        if (typeof InventoryApp !== 'undefined') {
                            InventoryApp.loadDeviceStats();
                        }
                    } else if (currentSection === 'estadisticas-insumos-section') {
                        if (typeof InventoryApp !== 'undefined') {
                            InventoryApp.loadSuppliesStats();
                        }
                    }
                });
            }
            
            // Configurar botones de actualización específicos
            const refreshMaintenanceBtn = document.getElementById('refresh-maintenance');
            if (refreshMaintenanceBtn) {
                refreshMaintenanceBtn.addEventListener('click', function() {
                    if (typeof MaintenanceManager !== 'undefined') {
                        MaintenanceManager.loadMaintenanceData();
                    }
                });
            }
            
            const refreshStatsBtn = document.getElementById('refresh-stats');
            if (refreshStatsBtn) {
                refreshStatsBtn.addEventListener('click', function() {
                    if (typeof InventoryApp !== 'undefined') {
                        InventoryApp.loadDeviceStats();
                    }
                });
            }
            
            const refreshInsumosStatsBtn = document.getElementById('refresh-insumos-stats');
            if (refreshInsumosStatsBtn) {
                refreshInsumosStatsBtn.addEventListener('click', function() {
                    if (typeof InventoryApp !== 'undefined') {
                        InventoryApp.loadSuppliesStats();
                    }
                });
            }
            
            const refreshUsersBtn = document.getElementById('refresh-users');
            if (refreshUsersBtn) {
                refreshUsersBtn.addEventListener('click', function() {
                    if (typeof AdminUsersManager !== 'undefined') {
                        AdminUsersManager.loadUsers();
                    }
                });
            }
            
            // Inicializar el dashboard por defecto
            showSection('dashboard-section');
        });
        
        // Función para volver al dashboard desde cualquier lugar
        window.goToDashboard = function() {
            showSection('dashboard-section');
        };
    </script>
</body>
</html>