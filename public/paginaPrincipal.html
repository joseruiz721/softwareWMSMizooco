<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="/manifest.json">
    <title>Gestion WMS | Servibarras</title>
    
    <!-- Estilos externos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/dashboard-enhanced.css">
</head>
<body>
    <div class="app-container">
        
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="img/logo1.jpg" alt="Servibarras Logo" class="logo">
                <span class="sidebar-title">Gestion WMS</span>
            </div>
            
            <ul class="menu-list">
                <!-- Menú Dispositivos -->
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-desktop dispositivo-icon"></i>
                        <span>Dispositivos</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li class="submenu-item">
                            <a href="/dispositivos" class="submenu-link">
                                <i class="fas fa-plus-circle"></i>
                                <span>Registrar Nuevo</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" id="estadisticas-link">
                                <i class="fas fa-plus-circle"></i>
                                <span>Dispositivos Mizooco</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <!-- Menú Repuestos -->
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i href="#" class="fas fa-tools"></i>
                        <span>Repuestos</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li class="submenu-item">
                            <a href="/repuestos" class="submenu-link"> 
                               <i class="fas fa-plus-circle"></i>
                               <span>Registrar Nuevo</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" id="estadisticas-insumos-link">
                                <i class="fas fa-chart-line"></i>
                                <span>Inventario de Repuestos</span>
                            </a>
                        </li>
                        
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" id="inventarios-link">
                                <i class="fas fa-clipboard-list"></i>
                                <span>Exportar Inventario</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <!-- Menú Mantenimientos -->
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-clipboard-check"></i>
                        <span>Mantenimientos</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li class="submenu-item">
                            <a href="/mantenimientos" class="submenu-link">
                                <i class="fas fa-plus-circle"></i>
                                <span>Registrar Nuevo</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" id="control-mantenimientos-link">
                                <i class="fas fa-list-alt"></i>
                                <span>Control de Mantenimientos</span>
                            </a>
                        </li>
                        <!-- En el menú de Mantenimientos - agrega esta opción -->
<li class="submenu-item">
    <a href="#" class="submenu-link" id="reportes-mensuales-link">
        <i class="fas fa-chart-bar"></i>
        <span>Reportes Mensuales</span>
    </a>
</li>
                    </ul>
                </li>
                
                <!-- Menú Configuración -->
                 
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-cog"></i>
                        <span>Configuración</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </a>
                    <ul class="submenu">
                    <li class="submenu-item">
    <a href="#" class="submenu-link" onclick="ProfileManager.loadAndShowProfile()">
        <i class="fas fa-user-cog"></i>
        <span>Perfil</span>
    </a>
</li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link">
                                <i class="fas fa-lock"></i>
                                <span>Seguridad</span>
                            </a>
                        </li>
                     <!-- En el menú de configuración - agregar esta opción -->
<li class="submenu-item">
    <a href="#" class="submenu-link" id="admin-users-link">
        <i class="fas fa-users-cog"></i>
        <span>Gestionar Usuarios</span>
    </a>
</li>   
                        <li class="submenu-item">
                            <a href="#" class="submenu-link">
                                <i class="fas fa-bell"></i>
                                <span>Notificaciones</span>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </aside>

        <!-- Contenido principal -->
        <div class="main-content">
            
            <!-- Header -->
            <header class="header">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Buscar dispositivos, repuestos..." autocomplete="off">
                    <div class="search-results-container" id="searchResults">
                        <!-- Los resultados de búsqueda se mostrarán aquí dinámicamente -->
                    </div>
                </div>
                
                <div class="header-actions">
                    <div class="notification-badge">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </div>

                    <div class="user-dropdown">
                        <div class="user-profile" id="userProfile">
                            <div class="user-avatar" id="userAvatar">GS</div>
                            <span class="user-name" id="userName">TECNICO</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="dropdown-menu" id="userDropdown">
                            <a href="#" class="dropdown-item">
                                <i class="fas fa-user"></i> Mi Perfil
                            </a>
                        
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Contenido del dashboard -->
            <div class="dashboard">
                
                <!-- Encabezado de página -->
                <div class="page-header">
                    <h1 class="page-title" style="color:#021e3a; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
                        Gestion WMS Mizooco
                    </h1>
                    <div id="welcome-message" style="margin-right: auto; margin-left: 20px; font-weight: 500; color: white;"></div>
                     <button class="btn btn-secondary" id="refreshPageBtn" title="Recargar página completa">
                          <i class="fas fa-redo-alt"></i> Refrescar Página
                    </button>
    
                    <button class="btn btn-primary" id="refreshDashboard">
                           <i class="fas fa-sync-alt"></i> Actualizar Datos
                    </button>
                </div>

                <!-- NUEVA SECCIÓN: Dashboard con Calendario -->
                <div class="dashboard-content" id="dashboard-section">
                    <div class="dashboard-grid">
                        <!-- Tarjetas de estadísticas principales MEJORADAS -->
                        <div class="stats-grid" id="main-stats">
                            <div class="stat-card">
                                <div class="stat-header">
                                    <h3 class="stat-title">Dispositivos Registrados</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-desktop"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="active-devices">0</div>
                                <div class="stat-trend" id="devices-trend">
                                    <i class="fas fa-arrow-up trend-up"></i>
                                    <span class="trend-text">Cargando...</span>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-header">
                                    <h3 class="stat-title">Repuestos</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-box"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="total-supplies">0</div>
                                <div class="stat-trend" id="supplies-trend">
                                    <i class="fas fa-arrow-up trend-up"></i>
                                    <span class="trend-text">Cargando...</span>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-header">
                                    <h3 class="stat-title">Alertas Hoy</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="today-alerts">0</div>
                                <div class="stat-trend" id="alerts-trend">
                                    <span class="trend-text">Cargando...</span>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-header">
                                    <h3 class="stat-title">Usuarios Activos</h3>
                                    <div class="stat-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                </div>
                                <div class="stat-value" id="active-techs">0</div>
                                <div class="stat-trend" id="techs-trend">
                                    <i class="fas fa-arrow-up trend-up"></i>
                                    <span class="trend-text">Cargando...</span>
                                </div>
                            </div>
                        </div>

                        <!-- NUEVO: Calendario de Mantenimientos -->
                        <div class="dashboard-row">
                            <div class="calendar-section">
                                <div class="section-header">
                                    <h3>Calendario de Mantenimientos</h3>
                                    <button class="btn btn-secondary" id="today-btn">Hoy</button>
                                </div>
                                <div id="calendar"></div>
                            </div>
                            
                            <div class="quick-actions">
                                <div class="section-header">
                                    <h3>Acciones Rápidas</h3>
                                </div>
                                <div class="action-buttons">
                                    <button class="action-btn" onclick="window.location.href='/mantenimientos'">
                                        <i class="fas fa-tools"></i>
                                        <span>Nuevo Mantenimiento</span>
                                    </button>
                                    <button class="action-btn" onclick="window.location.href='/dispositivos'">
                                        <i class="fas fa-desktop"></i>
                                        <span>Registrar Dispositivo</span>
                                    </button>
                                    <button class="action-btn" onclick="window.location.href='/repuestos'">
                                        <i class="fas fa-box"></i>
                                        <span>Agregar Repuesto</span>
                                    </button>
                                    <button class="action-btn" id="export-inventory-btn">
                                        <i class="fas fa-file-export"></i>
                                        <span>Exportar Inventario</span>
                                    </button>
                                </div>
                                
                                <!-- Alertas Recientes -->
                                <div class="recent-alerts">
                                    <div class="section-header">
                                        <h3>Alertas Recientes</h3>
                                    </div>
                                    <div class="alerts-list" id="recent-alerts">
                                        <!-- Las alertas se cargarán dinámicamente -->
                                        <div class="alert-item">
                                            <i class="fas fa-info-circle alert-info"></i>
                                            <span>Cargando alertas...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección: Control de Mantenimientos -->
                <div class="stats-section" id="control-mantenimientos-section" style="display: none;">
                    <div class="section-header">
                        <h2 style="color: #03213f; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);">
                            Control de Mantenimientos
                        </h2>
                        <button class="btn btn-secondary btn-back-dashboard">
                            <i class="fas fa-arrow-left"></i> Volver
                        </button>
                        <button class="btn btn-primary" id="refresh-maintenance">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                    
                    <div class="stats-container">
                        <div class="maintenance-table-container">
                            <table class="maintenance-table">
                                <thead>
                                    <tr>
                                        <th>Técnico</th>
                                        <th>Tipo</th>
                                       <th>Ubicación</th> <!-- CAMBIADO: De "Dispositivo" a "Ubicación" -->
                                        <th>Fecha</th>
                                        <th>Estado</th>
                                        <th>Descripción</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="maintenance-table-body">
                                    <!-- Los datos se cargarán aquí dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sección: Reportes Mensuales -->
<div class="stats-section" id="reportes-mensuales-section" style="display: none;">
    <div class="section-header">
        <h2 style="color: #03213f; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);">
            Reportes Mensuales de Mantenimientos
        </h2>
        <button class="btn btn-secondary btn-back-dashboard">
            <i class="fas fa-arrow-left"></i> Volver al Dashboard
        </button>
        <button class="btn btn-primary" id="generar-reporte-btn">
            <i class="fas fa-file-pdf"></i> Generar Reporte PDF
        </button>
    </div>
    
    <div class="reportes-container">
        <!-- Filtros -->
        <div class="filtros-reporte">
            <div class="filtro-group">
                <label for="mes-reporte">Mes:</label>
                <select id="mes-reporte" class="filtro-select">
                    <option value="1">Enero</option>
                    <option value="2">Febrero</option>
                    <option value="3">Marzo</option>
                    <option value="4">Abril</option>
                    <option value="5">Mayo</option>
                    <option value="6">Junio</option>
                    <option value="7">Julio</option>
                    <option value="8">Agosto</option>
                    <option value="9">Septiembre</option>
                    <option value="10">Octubre</option>
                    <option value="11">Noviembre</option>
                    <option value="12">Diciembre</option>
                </select>
            </div>
            
            <div class="filtro-group">
                <label for="anio-reporte">Año:</label>
                <select id="anio-reporte" class="filtro-select">
                    <!-- Se llenará dinámicamente -->
                </select>
            </div>
            
            <div class="filtro-group">
                <label for="tipo-reporte">Tipo de Reporte:</label>
                <select id="tipo-reporte" class="filtro-select">
                    <option value="completo">Reporte Completo</option>
                    <option value="preventivo">Solo Preventivos</option>
                    <option value="correctivo">Solo Correctivos</option>
                    <option value="predictivo">Solo Predictivos</option>
                </select>
            </div>
            
            <button class="btn btn-success" id="aplicar-filtros">
                <i class="fas fa-filter"></i> Aplicar Filtros
            </button>
        </div>

        <!-- Estadísticas Resumen -->
        <div class="estadisticas-resumen">
            <div class="stat-card mini">
                <div class="stat-header">
                    <h3 class="stat-title">Total Mantenimientos</h3>
                    <div class="stat-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                </div>
                <div class="stat-value" id="total-mantenimientos">0</div>
            </div>
            
            <div class="stat-card mini">
                <div class="stat-header">
                    <h3 class="stat-title">Preventivos</h3>
                    <div class="stat-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                </div>
                <div class="stat-value" id="total-preventivos">0</div>
            </div>
            
            <div class="stat-card mini">
                <div class="stat-header">
                    <h3 class="stat-title">Correctivos</h3>
                    <div class="stat-icon">
                        <i class="fas fa-tools"></i>
                    </div>
                </div>
                <div class="stat-value" id="total-correctivos">0</div>
            </div>
            
            <div class="stat-card mini">
                <div class="stat-header">
                    <h3 class="stat-title">Eficiencia</h3>
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                <div class="stat-value" id="eficiencia">0%</div>
            </div>
        </div>

        <!-- Gráficas -->
        <div class="reporte-charts">
            <div class="chart-card large">
                <h3>Distribución por Tipo</h3>
                <div class="chart-container">
                    <canvas id="tipo-mantenimiento-chart"></canvas>
                </div>
            </div>
            
            <div class="chart-card large">
                <h3>Mantenimientos por Técnico</h3>
                <div class="chart-container">
                    <canvas id="tecnico-chart"></canvas>
                </div>
            </div>
            
            <div class="chart-card large">
                <h3>Evolución Semanal</h3>
                <div class="chart-container">
                    <canvas id="evolucion-chart"></canvas>
                </div>
            </div>
            
            <div class="chart-card large">
                <h3>Dispositivos más Atendidos</h3>
                <div class="chart-container">
                    <canvas id="dispositivos-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tabla Detallada -->
        <div class="tabla-reporte">
            <div class="table-header">
                <h3>Detalle de Mantenimientos</h3>
                <button class="btn btn-secondary" id="exportar-excel">
                    <i class="fas fa-file-excel"></i> Exportar a Excel
                </button>
            </div>
            <div class="table-container">
                <table class="reporte-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Técnico</th>
                            <th>Tipo</th>
                            <th>Ubicación</th>
                            <th>Estado</th>
                            <th>Repuestos Usados</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-reporte-body">
                        <!-- Datos se cargarán aquí -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

                <!-- Sección: Estadísticas de Dispositivos -->
                <div class="stats-section" id="estadisticas-section" style="display: none;">
                    <div class="section-header">
                        <h2 style="color: #2c3e50; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);">
                            Dispositivos Mizooco
                        </h2>
                         <button class="btn btn-secondary btn-back-dashboard">
                            <i class="fas fa-arrow-left"></i> Volver
                        </button>
                        <button class="btn btn-primary" id="refresh-stats">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                    
                    <div class="stats-container">
                        <div class="device-type-controls">
                            <button id="btn-ordenadores" class="device-type-btn active">Ordenadores</button>
                            <button id="btn-access_point" class="device-type-btn">Access Point</button>
                            <button id="btn-readers" class="device-type-btn">Readers</button>
                            <button id="btn-etiquetadoras" class="device-type-btn">Etiquetadoras</button>
                            <button id="btn-tablets" class="device-type-btn">Tablets</button>
                            <button id="btn-lectores_qr" class="device-type-btn">Lectores QR</button>
                        </div>
                        
                        <div class="devices-table-container">
                            <table class="devices-table">
                                <thead>
                                    <tr>
                                        <th>Serial</th>
                                        <th>IP</th>
                                        <th>Ubicación</th>
                                        <th>Activo Fijo</th>
                                        <th>Estado</th>
                                        <th>Observaciones</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="devices-table-body">
                                    <!-- Los datos se cargarán aquí dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="stats-charts">
                            <div class="chart-card">
                                <h3>Distribución por Tipo</h3>
                                <div class="chart-container">
                                    <canvas id="type-chart"></canvas>
                                </div>
                            </div>
                            <div class="chart-card">
                                <h3>Distribución por Estado</h3>
                                <div class="chart-container">
                                    <canvas id="status-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección: Estadísticas de Repuestos -->
                <div class="stats-section" id="estadisticas-insumos-section" style="display: none;">
                    <div class="section-header">
                        <h2 style="color: rgb(4, 14, 58); text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);">
                            Inventario de Repuestos
                        </h2>
                        <button class="btn btn-secondary btn-back-dashboard">
                            <i class="fas fa-arrow-left"></i> Volver
                        </button>
                        <button class="btn btn-primary" id="refresh-insumos-stats">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                    
                    <div class="stats-container">
                        <div class="supply-category-controls">
                            <button id="btn-todos" class="supply-category-btn active">Todos</button>
                            <button id="btn-bajo_stock" class="supply-category-btn">Bajo Stock</button>
                            <button id="btn-agotados" class="supply-category-btn">Agotados</button>
                        </div>
                        
                        <div class="supplies-table-container">
                            <table class="supplies-table">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Código</th>
                                        <th>Stock</th>
                                        <th>Stock Mínimo</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="supplies-table-body">
                                    <!-- Los datos se cargarán aquí dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="stats-charts">
                            <div class="chart-card">
                                <h3>Distribución por Proceso</h3>
                                <div class="chart-container">
                                    <canvas id="category-chart"></canvas>
                                </div>
                            </div>
                            <div class="chart-card">
                                <h3>Niveles de Stock</h3>
                                <div class="chart-container">
                                    <canvas id="stock-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modales de la aplicación -->
                <!-- Modal: Edición de Mantenimientos -->
                <div id="maintenanceModal" class="maintenance-modal">
                    <div class="maintenance-modal-content">
                        <span class="close-modal" onclick="MaintenanceManager.closeModal()">&times;</span>
                        <h2 id="maintenance-modal-title">Registrar Mantenimiento</h2>
                        <form id="maintenanceForm">
                            <div class="maintenance-form-group">
                                <label for="maintenance-technician">Técnico *</label>
                                <select id="maintenance-technician" name="id_usuarios" required>
                                    <option value="">Seleccionar técnico</option>
                                </select>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-type">Tipo de Mantenimiento *</label>
                                <select id="maintenance-type" name="tipo" required>
                                    <option value="">Seleccionar tipo</option>
                                    <option value="Preventivo">Preventivo</option>
                                    <option value="Correctivo">Correctivo</option>
                                    <option value="Predictivo">Predictivo</option>
                                </select>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-device">Dispositivo *</label>
                                <select id="maintenance-device" name="id_dispositivo" required>
                                    <option value="">Seleccionar dispositivo</option>
                                 </select>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-date">Fecha *</label>
                                <input type="date" id="maintenance-date" name="fecha" required>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-status">Estado *</label>
                                <select id="maintenance-status" name="estado" required>
                                    <option value="Pendiente">Pendiente</option>
                                    <option value="En Progreso">En Progreso</option>
                                    <option value="Completado">Completado</option>
                                    <option value="Cancelado">Cancelado</option>
                                </select>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-supply">Repuesto (Opcional)</label>
                                <select id="maintenance-supply" name="id_repuesto">
                                    <option value="">Sin repuesto</option>
                                </select>
                                <small class="form-help">Deje en "Sin repuesto" si no aplica</small>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-description">Descripción *</label>
                                <textarea id="maintenance-description" name="descripcion" 
                                         placeholder="Describa el mantenimiento a realizar..." 
                                         required></textarea>
                            </div>
                            
                            <div class="maintenance-form-group">
                                <label for="maintenance-observations">Observaciones (Opcional)</label>
                                <textarea id="maintenance-observations" name="observaciones" 
                                         placeholder="Observaciones adicionales..."></textarea>
                            </div>
                            
                            <div class="maintenance-form-actions">
                                <button type="button" class="btn btn-back" onclick="MaintenanceManager.closeModal()">Cancelar</button>
                                <button type="submit" class="btn btn-primary" id="maintenance-submit-btn">
                                    <span id="maintenance-submit-text">Guardar</span>
                                    <div id="maintenance-loading-spinner" class="loading-spinner" style="display: none;"></div>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Modal: Edición de Dispositivos -->
                <div id="editModal" class="edit-modal">
                    <div class="edit-modal-content">
                        <span class="close-modal" onclick="InventoryApp.closeEditModal()">&times;</span>
                        <h2>Editar Dispositivo</h2>
                        <form id="editForm">
                            <div id="editFormFields"></div>
                            <div class="edit-form-actions">
                                <button type="button" class="btn btn-back" onclick="InventoryApp.closeEditModal()">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Modal: Exportación de Inventarios -->
                <div id="exportModal" class="export-modal">
                    <div class="export-modal-content">
                        <span class="close-modal" onclick="InventoryApp.closeModal('exportModal')">&times;</span>
                        <h2 style="color: #000080;">Exportar Inventario</h2>
                        <p>Seleccione el formato para exportar el inventario actual:</p>
                        
                        <div class="export-options">
                            <button class="export-btn export-excel" onclick="InventoryApp.exportInventory('excel')">
                                <i class="fas fa-file-excel"></i> Exportar a Excel
                            </button>
                            <button class="export-btn export-cancel" onclick="InventoryApp.closeModal('exportModal')">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                        
                        <div id="exportStatus" class="export-status" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p class="status-message"></p>
                        </div>
                    </div>
                </div>
                <!-- Modal: Perfil de Usuario -->
<div id="profileModal" class="modal" style="display: none;">
    <div class="modal-content profile-modal-content">
        <span class="close-modal" onclick="ProfileManager.closeProfileModal()">&times;</span>
        
        <div class="modal-header">
            <h2><i class="fas fa-user-circle profile-icon"></i> Perfil del Usuario</h2>
            <p class="modal-subtitle">Gestiona tu información personal y seguridad</p>
        </div>
        
        <div class="profile-info">
            <!-- Información Personal -->
            <div class="info-section">
                <h3><i class="fas fa-id-card"></i> Información Personal</h3>
                
                <div class="info-card editable">
                    <div class="info-row">
                        <div class="info-icon"><i class="fas fa-user"></i></div>
                        <div class="info-content">
                            <div class="info-label">Nombre completo</div>
                            <div id="profile-name" class="info-value">Cargando...</div>
                            <input type="text" id="edit-profile-name" class="info-input" style="display: none;" placeholder="Ingrese su nombre">
                        </div>
                        <button class="btn-edit" onclick="ProfileManager.toggleEdit('name')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
                
                <div class="info-card editable">
                    <div class="info-row">
                        <div class="info-icon"><i class="fas fa-id-card"></i></div>
                        <div class="info-content">
                            <div class="info-label">Cédula</div>
                            <div id="profile-cedula" class="info-value">Cargando...</div>
                            <input type="text" id="edit-profile-cedula" class="info-input" style="display: none;" placeholder="Ingrese su cédula">
                        </div>
                        <button class="btn-edit" onclick="ProfileManager.toggleEdit('cedula')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
                
                <div class="info-card editable">
                    <div class="info-row">
                        <div class="info-icon"><i class="fas fa-envelope"></i></div>
                        <div class="info-content">
                            <div class="info-label">Correo electrónico</div>
                            <div id="profile-email" class="info-value">Cargando...</div>
                            <input type="email" id="edit-profile-email" class="info-input" style="display: none;" placeholder="Ingrese su correo">
                        </div>
                        <button class="btn-edit" onclick="ProfileManager.toggleEdit('email')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
                
                <div class="info-card">
                    <div class="info-row">
                        <div class="info-icon"><i class="fas fa-calendar-plus"></i></div>
                        <div class="info-content">
                            <div class="info-label">Miembro desde</div>
                            <div id="profile-date" class="info-value">Cargando...</div>
                        </div>
                    </div>
                </div>
            </div>

        <!-- Botón para cambiar contraseña -->
<button class="btn btn-primary" id="toggle-password-change" onclick="ProfileManager.togglePasswordChange()">
    <i class="fas fa-key"></i> Cambiar Contraseña
</button>
<!-- Sección de cambio de contraseña MEJORADA -->
<div class="info-card" id="password-change-section" style="display: none;">
    <div class="info-row">
        <div class="info-icon"><i class="fas fa-key"></i></div>
        <div class="info-content">
            <div class="info-label">Nueva contraseña</div>
            <div class="password-input-container">
                <input type="password" id="new-password" class="info-input password-input" 
                       placeholder="Mínimo 6 caracteres" 
                       oninput="ProfileManager.updatePasswordStrength()">
                <button type="button" class="toggle-password-btn" 
                        onclick="ProfileManager.togglePasswordVisibility('new-password', this)"
                        title="Mostrar contraseña">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            
            <!-- Indicador de fortaleza -->
            <div class="password-strength-meter" id="password-strength-meter">
                <div class="strength-bar"></div>
            </div>
            <div class="password-strength-text" id="password-strength-text" style="font-size: 11px; color: #7f8c8d;">
                Ingresa una contraseña
            </div>
            
            <!-- Validaciones -->
            <div class="password-validations" id="password-validations" style="margin-top: 8px;">
                <div class="validation-item invalid">
                    <i class="fas fa-times validation-icon"></i>
                    <span>Mínimo 6 caracteres</span>
                </div>
                <div class="validation-item invalid">
                    <i class="fas fa-times validation-icon"></i>
                    <span>Al menos una mayúscula</span>
                </div>
                <div class="validation-item invalid">
                    <i class="fas fa-times validation-icon"></i>
                    <span>Al menos una minúscula</span>
                </div>
                <div class="validation-item invalid">
                    <i class="fas fa-times validation-icon"></i>
                    <span>Al menos un número</span>
                </div>
            </div>
            
            <div class="info-label" style="margin-top: 15px;">Confirmar contraseña</div>
            <div class="password-input-container">
                <input type="password" id="confirm-password" class="info-input password-input" 
                       placeholder="Repita la contraseña">
                <button type="button" class="toggle-password-btn" 
                        onclick="ProfileManager.togglePasswordVisibility('confirm-password', this)"
                        title="Mostrar contraseña">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            
            <!-- Indicador de coincidencia -->
            <div id="password-match" style="font-size: 11px; margin-top: 5px;"></div>
        </div>
    </div>
</div>
<!-- Botón guardar -->
<button class="btn btn-success" id="save-profile-btn" style="display: none;" onclick="ProfileManager.saveProfile()">
    <i class="fas fa-save"></i> Guardar Cambios
</button>
            <div class="action-group">
                <button class="btn btn-warning" onclick="ProfileManager.loadAndShowProfile()">
                    <i class="fas fa-sync"></i> Actualizar
                </button>
                <button class="btn btn-danger" onclick="ProfileManager.confirmDeleteAccount()">
                    <i class="fas fa-trash"></i> Eliminar Cuenta
                </button>
                <button class="btn btn-secondary" onclick="ProfileManager.closeProfileModal()">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Confirmación de eliminación de cuenta -->
<div id="deleteAccountModal" class="modal" style="display: none;">
    <div class="modal-content danger-modal">
        <span class="close-modal" onclick="ProfileManager.closeModal('deleteAccountModal')">&times;</span>
        
        <div class="modal-header danger-header">
            <h2><i class="fas fa-exclamation-triangle"></i> Confirmar Eliminación</h2>
            <p class="modal-subtitle">Esta acción no se puede deshacer</p>
        </div>
        
        <div class="delete-warning">
            <div class="warning-icon">
                <i class="fas fa-skull-crossbones"></i>
            </div>
            <div class="warning-content">
                <h3>¿Está completamente seguro?</h3>
                <p>Al eliminar su cuenta:</p>
                <ul>
                    <li>Se perderán todos sus datos permanentemente</li>
                    <li>No podrá recuperar su cuenta</li>
                    <li>Se cerrará su sesión inmediatamente</li>
                </ul>
                <p>Para confirmar, escriba <strong>ELIMINAR</strong> en el campo siguiente:</p>
                
                <input type="text" id="confirm-delete-text" class="confirm-input" 
                       placeholder="Escriba ELIMINAR para confirmar">
            </div>
        </div>
        
        <div class="modal-actions">
            <button class="btn btn-danger" id="confirm-delete-btn" onclick="ProfileManager.deleteAccount()" disabled>
                <i class="fas fa-trash"></i> Eliminar Cuenta Permanentemente
            </button>
            <button class="btn btn-secondary" onclick="ProfileManager.closeModal('deleteAccountModal')">
                <i class="fas fa-times"></i> Cancelar
            </button>
        </div>
    </div>
</div>

                <!-- Footer -->
                <footer class="footer">
                    <div class="footer-content">
                        <span class="version">Versión 2.1</span>
                        <span class="separator">|</span>
                        <span class="copyright">&copy; 2025 Gestion WMS Mizooco. Todos los derechos reservados.</span>
                    </div>
                </footer>
            </div>
        </div>
    </div>

    <!-- Scripts externos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
 <!-- Librerías para exportación (mover antes de los scripts que las usan) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- Scripts de la aplicación -->
<script src="/js/api.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/charts.js"></script>
<script src="/js/profileManager.js"></script>
<script src="/js/maintenanceManager.js"></script>
<script src="/js/suppliesTableManager.js"></script>
<script src="/js/inventoryApp.js"></script>
<script src="/js/reportesManager.js"></script> <!-- NUEVO -->
<script src="/js/dashboard-enhanced.js"></script>
<script src="/js/admin-users.js"></script>
</body>
</html>